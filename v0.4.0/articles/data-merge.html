<!DOCTYPE html>
<!-- Generated by pkgdown + https://github.com/insightsengineering/r-pkgdown-multiversion -->
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="teal.transform">
<title>Data merge • teal.transform</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Data merge">
<meta property="og:description" content="teal.transform">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><link rel="stylesheet" href="../consent.css">
<script src="../consent.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">teal.transform</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0</small>

    <div style="width: 140px; margin-left: 0.5rem;"> <small class="nav-text text-muted me-auto">part of</small> <img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/nest.png?raw=true" alt="NEST" style="height: 30px;"><a href="https://pharmaverse.org/" class="external-link"><img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/pharmaverse.png?raw=true" alt="pharmaverse" style="height: 28px;"></a> </div>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/teal-transform.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/data-extract-merge.html">Combining data-extract with data-merge</a>
    <a class="dropdown-item" href="../articles/data-extract.html">Data extract</a>
    <a class="dropdown-item" href="../articles/data-merge.html">Data merge</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<!-- start dropdown for versions --> <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-versions">Versions</a>
    <div class="dropdown-menu" aria-labelledby="dropdown-versions">
    <a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.transform/release-candidate">release-candidate</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.transform/main">main</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.transform/latest-tag">latest-tag</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.transform/v0.7.0">v0.7.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.transform/v0.6.0">v0.6.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.transform/v0.6.0-rc1">v0.6.0-rc1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.transform/v0.5.0">v0.5.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.transform/v0.5.0-rc1">v0.5.0-rc1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.transform/v0.4.0">v0.4.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.transform/v0.3.0">v0.3.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.transform/v0.2.0">v0.2.0</a>
</div>
</li>
<!-- end dropdown for versions -->
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-reports">Reports</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-reports">
    <a class="dropdown-item" href="../coverage-report/">Coverage report</a>
    <a class="dropdown-item" href="../unit-test-report/">Unit test report</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/insightsengineering/teal.transform">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Data merge</h1>
                        <h4 data-toc-skip class="author">NEST
coreDev</h4>
            
            <h4 data-toc-skip class="date">2022-05-11</h4>
      
      
      <div class="d-none name"><code>data-merge.Rmd</code></div>
    </div>

    
    
<p>Combining datasets is a crucial step when using modules with more
than one dataset. In the context of <code>teal</code>, we use the term
“merge” to combine datasets where two functions are offered
<code>merge_expression_module</code> and
<code>merge_expression_srv</code>. Depending on the specific scenario,
one or the other shall be used.</p>
<p>When no processing of the <code>data_extract</code> list is required,
the <code>merge_expression_module</code> function is used to read the
data and the <code>data_extract_spec</code>’s list and apply the
merging. It is a wrapper that combines
<code><a href="../reference/data_extract_multiple_srv.html">data_extract_multiple_srv()</a></code> and
<code><a href="../reference/merge_expression_srv.html">merge_expression_srv()</a></code> see below for more details. With
additional processing of the <code>data_extract</code> list input,
<code><a href="../reference/merge_expression_srv.html">merge_expression_srv()</a></code> can be combined with
<code><a href="../reference/data_extract_multiple_srv.html">data_extract_multiple_srv()</a></code> or
<code><a href="../reference/data_extract_srv.html">data_extract_srv()</a></code> to customize the
<code>selector_list</code> input.</p>
<p>In the coming sections, we will show examples of both scenarios.</p>
<div class="section level3">
<h3 id="merge_expression_module">
<code>merge_expression_module</code><a class="anchor" aria-label="anchor" href="#merge_expression_module"></a>
</h3>
<p>With <code>merge_expression_module</code> solely, all you would need
is a list of <code>data_extract_spec</code> objects for the
<code>data_extract</code> argument, a list of reactive or non-reactive
<code>data.frame</code> objects and a list of join keys corresponding to
every <code>data.frame</code> object.</p>
<div class="section level4">
<h4 id="app-code">App code<a class="anchor" aria-label="anchor" href="#app-code"></a>
</h4>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">teal.transform</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: magrittr</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">adsl_extract</span> <span class="op">&lt;-</span> <span class="fu">teal.transform</span><span class="fu">::</span><span class="fu"><a href="../reference/data_extract_spec.html">data_extract_spec</a></span><span class="op">(</span></span>
<span>  dataname <span class="op">=</span> <span class="st">"ADSL"</span>,</span>
<span>  select <span class="op">=</span> <span class="fu"><a href="../reference/select_spec.html">select_spec</a></span><span class="op">(</span></span>
<span>    label <span class="op">=</span> <span class="st">"Select variable:"</span>,</span>
<span>    choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGE"</span>, <span class="st">"BMRKR1"</span><span class="op">)</span>,</span>
<span>    selected <span class="op">=</span> <span class="st">"AGE"</span>,</span>
<span>    multiple <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    fixed <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">adtte_extract</span> <span class="op">&lt;-</span> <span class="fu">teal.transform</span><span class="fu">::</span><span class="fu"><a href="../reference/data_extract_spec.html">data_extract_spec</a></span><span class="op">(</span></span>
<span>  dataname <span class="op">=</span> <span class="st">"ADTTE"</span>,</span>
<span>  select <span class="op">=</span> <span class="fu"><a href="../reference/select_spec.html">select_spec</a></span><span class="op">(</span></span>
<span>    choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AVAL"</span>, <span class="st">"ASEQ"</span><span class="op">)</span>,</span>
<span>    selected <span class="op">=</span> <span class="st">"AVAL"</span>,</span>
<span>    multiple <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    fixed <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_extracts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>adsl_extract <span class="op">=</span> <span class="va">adsl_extract</span>, adtte_extract <span class="op">=</span> <span class="va">adtte_extract</span><span class="op">)</span></span>
<span></span>
<span><span class="va">merge_ui</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span>, <span class="va">data_extracts</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/NS.html" class="external-link">NS</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span>  <span class="fu">teal.widgets</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/teal.widgets/man/standard_layout.html" class="external-link">standard_layout</a></span><span class="op">(</span></span>
<span>    output <span class="op">=</span> <span class="fu">teal.widgets</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/teal.widgets/man/white_small_well.html" class="external-link">white_small_well</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textOutput.html" class="external-link">verbatimTextOutput</a></span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">"expr"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderDataTable.html" class="external-link">dataTableOutput</a></span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    encoding <span class="op">=</span> <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">div</a></span><span class="op">(</span></span>
<span>      <span class="fu">teal.transform</span><span class="fu">::</span><span class="fu"><a href="../reference/data_extract_ui.html">data_extract_ui</a></span><span class="op">(</span></span>
<span>        <span class="fu">ns</span><span class="op">(</span><span class="st">"adsl_extract"</span><span class="op">)</span>, <span class="co"># must correspond with data_extracts list names</span></span>
<span>        label <span class="op">=</span> <span class="st">"ADSL extract"</span>,</span>
<span>        <span class="va">data_extracts</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="fu">teal.transform</span><span class="fu">::</span><span class="fu"><a href="../reference/data_extract_ui.html">data_extract_ui</a></span><span class="op">(</span></span>
<span>        <span class="fu">ns</span><span class="op">(</span><span class="st">"adtte_extract"</span><span class="op">)</span>, <span class="co"># must correspond with data_extracts list names</span></span>
<span>        label <span class="op">=</span> <span class="st">"ADTTE extract"</span>,</span>
<span>        <span class="va">data_extracts</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">merge_module</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span>, <span class="va">datasets</span>, <span class="va">data_extracts</span>, <span class="va">join_keys</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/moduleServer.html" class="external-link">moduleServer</a></span><span class="op">(</span><span class="va">id</span>, <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">merged_data</span> <span class="op">&lt;-</span> <span class="fu">teal.transform</span><span class="fu">::</span><span class="fu"><a href="../reference/merge_expression_module.html">merge_expression_module</a></span><span class="op">(</span></span>
<span>      data_extract <span class="op">=</span> <span class="va">data_extracts</span>,</span>
<span>      datasets <span class="op">=</span> <span class="va">datasets</span>,</span>
<span>      join_keys <span class="op">=</span> <span class="va">join_keys</span>,</span>
<span>      merge_function <span class="op">=</span> <span class="st">"dplyr::left_join"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="va">ANL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span> <span class="co"># nolint</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span>envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list2env.html" class="external-link">list2env</a></span><span class="op">(</span><span class="va">datasets</span><span class="op">)</span>, expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">as.expression</a></span><span class="op">(</span><span class="fu">merged_data</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">expr</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html" class="external-link">renderText</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu">merged_data</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">expr</span>, collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderDataTable.html" class="external-link">renderDataTable</a></span><span class="op">(</span><span class="fu">ANL</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define data.frame objects</span></span>
<span><span class="va">ADSL</span> <span class="op">&lt;-</span> <span class="fu">teal.transform</span><span class="fu">::</span><span class="va"><a href="../reference/rADSL.html">rADSL</a></span> <span class="co"># nolint</span></span>
<span><span class="va">ADTTE</span> <span class="op">&lt;-</span> <span class="fu">teal.transform</span><span class="fu">::</span><span class="va"><a href="../reference/rADTTE.html">rADTTE</a></span> <span class="co"># nolint</span></span>
<span></span>
<span><span class="co"># create a list of data.frame objects</span></span>
<span><span class="va">datasets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ADSL <span class="op">=</span> <span class="va">ADSL</span>, ADTTE <span class="op">=</span> <span class="va">ADTTE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create  join_keys</span></span>
<span><span class="va">join_keys</span> <span class="op">&lt;-</span> <span class="fu">teal.data</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/teal.data/man/join_keys.html" class="external-link">join_keys</a></span><span class="op">(</span></span>
<span>  <span class="fu">teal.data</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/teal.data/man/join_key.html" class="external-link">join_key</a></span><span class="op">(</span><span class="st">"ADSL"</span>, <span class="st">"ADSL"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"STUDYID"</span>, <span class="st">"USUBJID"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu">teal.data</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/teal.data/man/join_key.html" class="external-link">join_key</a></span><span class="op">(</span><span class="st">"ADSL"</span>, <span class="st">"ADTTE"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"STUDYID"</span>, <span class="st">"USUBJID"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu">teal.data</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/teal.data/man/join_key.html" class="external-link">join_key</a></span><span class="op">(</span><span class="st">"ADTTE"</span>, <span class="st">"ADTTE"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"STUDYID"</span>, <span class="st">"USUBJID"</span>, <span class="st">"PARAMCD"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="shiny-app">Shiny app<a class="anchor" aria-label="anchor" href="#shiny-app"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span></span>
<span>  ui <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span><span class="fu">merge_ui</span><span class="op">(</span><span class="st">"data_merge"</span>, <span class="va">data_extracts</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  server <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">merge_module</span><span class="op">(</span><span class="st">"data_merge"</span>, <span class="va">datasets</span>, <span class="va">data_extracts</span>, <span class="va">join_keys</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="data_extract_multiple_srv-merge_expression_srv">
<code>data_extract_multiple_srv</code> +
<code>merge_expression_srv</code><a class="anchor" aria-label="anchor" href="#data_extract_multiple_srv-merge_expression_srv"></a>
</h3>
<p>In the scenario above, if the user deselects the <code>ADTTE</code>
variable, the merging between <code>ADTTE</code> and <code>ADSL</code>
would still take place even though <code>ADTTE</code> is not used or
needed here. Here, the developer might update the
<code>selector_list</code> input in a reactive manner so that it gets
updated based on conditions set by the developer. Below, we reuse the
input from above and we update the <code>app</code> server so that the
<code>adtte_extract</code> is removed from the
<code>selector_list</code> input when no <code>ADTTE</code> variable is
selected and the <code>reactive_selector_list</code> is passed to
<code>merge_expression_srv</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">merge_module</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span>, <span class="va">datasets</span>, <span class="va">data_extracts</span>, <span class="va">join_keys</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/moduleServer.html" class="external-link">moduleServer</a></span><span class="op">(</span><span class="va">id</span>, <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">selector_list</span> <span class="op">&lt;-</span> <span class="fu">teal.transform</span><span class="fu">::</span><span class="fu"><a href="../reference/data_extract_multiple_srv.html">data_extract_multiple_srv</a></span><span class="op">(</span><span class="va">data_extracts</span>, <span class="va">datasets</span>, <span class="va">join_keys</span><span class="op">)</span></span>
<span>    <span class="va">reactive_selector_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="fu">selector_list</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">adtte_extract</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu">selector_list</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">adtte_extract</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">select</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu">selector_list</span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu">selector_list</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"adtte_extract"</span><span class="op">]</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="fu">selector_list</span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">merged_data</span> <span class="op">&lt;-</span> <span class="fu">teal.transform</span><span class="fu">::</span><span class="fu"><a href="../reference/merge_expression_srv.html">merge_expression_srv</a></span><span class="op">(</span></span>
<span>      selector_list <span class="op">=</span> <span class="va">reactive_selector_list</span>,</span>
<span>      datasets <span class="op">=</span> <span class="va">datasets</span>,</span>
<span>      join_keys <span class="op">=</span> <span class="va">join_keys</span>,</span>
<span>      merge_function <span class="op">=</span> <span class="st">"dplyr::left_join"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="va">ANL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span> <span class="co"># nolint</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span>envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list2env.html" class="external-link">list2env</a></span><span class="op">(</span><span class="va">datasets</span><span class="op">)</span>, expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">as.expression</a></span><span class="op">(</span><span class="fu">merged_data</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">expr</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html" class="external-link">renderText</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu">merged_data</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">expr</span>, collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderDataTable.html" class="external-link">renderDataTable</a></span><span class="op">(</span><span class="fu">ANL</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level4">
<h4 id="shiny-app-1">Shiny app<a class="anchor" aria-label="anchor" href="#shiny-app-1"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span></span>
<span>  ui <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span><span class="fu">merge_ui</span><span class="op">(</span><span class="st">"data_merge"</span>, <span class="va">data_extracts</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  server <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">merge_module</span><span class="op">(</span><span class="st">"data_merge"</span>, <span class="va">datasets</span>, <span class="va">data_extracts</span>, <span class="va">join_keys</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><code>merge_expression_module</code> is replaced here with three
parts:</p>
<ol style="list-style-type: decimal">
<li>
<code>selector_list</code>: output of
<code>data_extract_multiple_srv</code> which loops over the list of
data_extract given and runs <code>data_extract_srv</code> for each one
returning a list of reactive objects.</li>
<li>
<code>reactive_selector_list</code>: intermediate reactive list
updating <code>selector_list</code> content</li>
<li>
<code>merged_data</code>: output of
<code>merge_expression_srv</code> using
<code>reactive_selector_list</code> as input</li>
</ol>
</div>
</div>
<div class="section level3">
<h3 id="output-from-merging">Output from merging<a class="anchor" aria-label="anchor" href="#output-from-merging"></a>
</h3>
<p>Both merge functions, <code>merge_expression_srv</code> and
<code>merge_expression_module</code>, return a reactive object which
contains a list of the following elements:</p>
<ul>
<li>
<code>expr</code>: code needed to replicate merged dataset</li>
<li>
<code>columns_source</code>: list of columns selected per
selector</li>
<li>
<code>keys</code>: the keys of the merged dataset</li>
<li>
<code>filter_info</code>: filters that are applied on the data</li>
</ul>
<p>These elements can be further used inside the server to retrieve and
use information about the selections, data, filters, …</p>
</div>
<div class="section level2">
<h2 id="merging-of-non-cdisc-datasets">Merging of non <code>CDISC</code> datasets<a class="anchor" aria-label="anchor" href="#merging-of-non-cdisc-datasets"></a>
</h2>
<p>General datasets do not share the same relationships as
<code>CDISC</code> datasets thus these relationships must be specified
by the <code>join_keys</code> functions. For more information, please
refer to the <code>Join Keys</code> <a href="https://insightsengineering.github.io/teal/articles/join-keys" class="external-link">vignette</a>.</p>
<p>The data merge module respects the relationships given by the user
and in the case of multiple datasets to merge, the order is specified by
the order of elements in the <code>data_extract</code> argument of the
<code>merge_expression_module</code> function. Merging groups of
datasets with complex relationships can quickly become challenging to
specify so please take extra care when setting this up.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="nest">
  <p>teal.transform is a part of the <strong>NEST</strong> and <a href="https://pharmaverse.org/" class="external-link"><strong>pharmaverse</strong></a>.</p>
</div>
<script type="text/javascript" src="../analytics.js"></script></footer>
</div>

  

  

  </body>
</html>
